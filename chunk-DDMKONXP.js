import{a as te}from"./chunk-E3D2QGJ5.js";import{a as ee}from"./chunk-QIJAE5W3.js";import{a as G,b as u,c as H,d as A,f as Q,h as R,i as U,j as Y,k as J,l as K,m as W,n as X,p as Z}from"./chunk-LSYD3J5U.js";import"./chunk-OKL6TN3N.js";import{e as z}from"./chunk-JJN6UOWY.js";import{t as q}from"./chunk-WH2QT74X.js";import{a as $,b as V}from"./chunk-4ULCVYXL.js";import{c as j,d as L}from"./chunk-CKQWD7NW.js";import{Cb as l,Db as m,Eb as s,Fb as O,Lb as F,Oa as i,Ob as p,Pa as v,Pb as c,Z as E,_a as C,a as w,ab as g,ca as N,cb as T,e as P,eb as f,fa as B,fb as S,gb as I,hb as M,ib as a,jb as n,kb as _,sb as b,tb as k,wb as D}from"./chunk-MOSC54PF.js";var ie=(()=>{let o=class o{constructor(r){this.http=r,this.jsonUrl="assets/cities/cities.json"}getCities(){return this.http.get(this.jsonUrl)}};o.\u0275fac=function(d){return new(d||o)(N(q))},o.\u0275prov=E({token:o,factory:o.\u0275fac,providedIn:"root"});let t=o;return t})();function oe(t,o){if(t&1&&(a(0,"div")(1,"h6",3),l(2),n(),a(3,"p",3),l(4),n()()),t&2){let h=o.$implicit;i(2),O("",h.wine.name," ",h.quantity,"x"),i(2),s("",h.wine.price*h.quantity," \u20BE")}}function le(t,o){t&1&&(a(0,"small"),l(1),p(2,"translate"),n()),t&2&&(i(),m(c(2,1,"auth.required-field")))}function pe(t,o){t&1&&(a(0,"small"),l(1),p(2,"translate"),n()),t&2&&(i(),m(c(2,1,"auth.invalid-field")))}function ce(t,o){t&1&&(a(0,"small"),l(1),p(2,"translate"),n()),t&2&&(i(),m(c(2,1,"auth.required-field")))}function de(t,o){t&1&&(a(0,"small"),l(1),p(2,"translate"),n()),t&2&&(i(),m(c(2,1,"auth.invalid-field")))}function me(t,o){t&1&&(a(0,"small"),l(1),p(2,"translate"),n()),t&2&&(i(),m(c(2,1,"auth.required-field")))}function se(t,o){t&1&&(a(0,"small"),l(1),p(2,"translate"),n()),t&2&&(i(),m(c(2,1,"auth.invalid-field")))}function ue(t,o){t&1&&(a(0,"small"),l(1),p(2,"translate"),n()),t&2&&(i(),m(c(2,1,"auth.required-field")))}function he(t,o){if(t&1&&l(0),t&2){let h=k().$implicit;s(" ",h.name_ka," ")}}function ge(t,o){if(t&1&&l(0),t&2){let h=k().$implicit;s(" ",h.name_en," ")}}function ve(t,o){if(t&1&&(a(0,"option",19),C(1,he,1,1)(2,ge,1,1),n()),t&2){let h=o.$implicit,r=k();D("value",h.name_ka),i(),f(r.isGeorgian?1:2)}}function Ce(t,o){t&1&&(a(0,"small"),l(1),p(2,"translate"),n()),t&2&&(i(),m(c(2,1,"auth.required-field")))}function fe(t,o){t&1&&(a(0,"small"),l(1),p(2,"translate"),n()),t&2&&(i(),m(c(2,1,"auth.invalid-field")))}var Ee=(()=>{let o=class o{constructor(r,d,e,y,x,ne){this.cartService=r,this.fb=d,this.orderService=e,this.citiesService=y,this.languageService=x,this.router=ne,this.cartItems=[],this.cities=[],this.isGeorgian=!1,this.subscription=new P}ngOnInit(){this.getCartItems(),this.initCheckoutForm(),this.getCities(),this.checkLanguage()}ngOnDestroy(){this.subscription.unsubscribe()}onSubmit(){let r=w({},this.checkoutForm.value);delete r.cardHolderName,delete r.cardNumber,delete r.cvv,delete r.expiryDate,this.subscription.add(this.orderService.addOrder(r).subscribe(()=>{this.cartService.clearCart(),this.router.navigate(["/checkout-success"])},d=>console.error(d)))}formatCardNumber(r){let d=r.target,e=d.value.replace(/\s+/g,"");e.length>0&&(e=e.match(/.{1,4}/g)?.join(" ")??e),d.value=e,this.checkoutForm.get("cardNumber")?.setValue(e)}formatExpiryDate(r){let e=r.target.value.replace(/\D/g,"");e.length>=2&&(e=e.substring(0,2)+"/"+e.substring(2,4)),this.checkoutForm.get("expiryDate")?.setValue(e)}getTotalAmount(){return this.cartItems.reduce((r,d)=>r+d.wine.price*d.quantity,0)}scrollOnTop(){window.scrollTo({top:0,behavior:"smooth"})}getTotalQuantity(){return this.cartItems.reduce((r,d)=>r+d.quantity,0)}get cardNumber(){return this.checkoutForm.get("cardNumber")}get expiryDate(){return this.checkoutForm.get("expiryDate")}get cvv(){return this.checkoutForm.get("cvv")}get cardHolderName(){return this.checkoutForm.get("cardHolderName")}get address(){return this.checkoutForm.get("address")}get zip(){return this.checkoutForm.get("zipCode")}get name(){return this.checkoutForm.get("cardHolderName")}getCartItems(){this.subscription.add(this.cartService.cartItems$.subscribe(r=>{this.cartItems=r}))}initCheckoutForm(){this.checkoutForm=this.fb.group({cardNumber:["",[u.required,u.pattern(/^\d{4} \d{4} \d{4} \d{4}$/)]],expiryDate:["",[u.required,u.pattern(/^\d{2}\/\d{2}$/)]],cvv:["",[u.required,u.pattern(/^\d{3}$/)]],cardHolderName:["",[u.required]],address:["",[u.required]],city:["",u.required],zipCode:["",[u.required,u.pattern(/^\d{4}$/)]],comment:[""],items:this.fb.array(this.cartItems.map(r=>this.fb.group({wineId:r.wine.id,quantity:r.quantity})))})}getCities(){this.subscription.add(this.citiesService.getCities().subscribe(r=>{this.cities=r.cities},r=>console.error(r)))}checkLanguage(){this.subscription.add(this.languageService.language$.subscribe(r=>{this.isGeorgian=r==="geo"}))}};o.\u0275fac=function(d){return new(d||o)(v(te),v(X),v(ee),v(ie),v($),v(z))},o.\u0275cmp=B({type:o,selectors:[["app-checkout"]],standalone:!0,features:[F],decls:83,vars:61,consts:[[1,"wrapper"],[1,"receipt"],[3,"appLangClass"],[1,"eng-primary"],[3,"ngSubmit","formGroup","appLangClass"],[1,"form-group"],["for","card-number"],["type","text","id","card-number","name","card-number","formControlName","cardNumber","placeholder","1234 1234 1234 1234","maxlength","19",1,"form-control",3,"input"],[1,"split"],["for","expiry-date"],["type","text","id","expiry-date","name","expiry-date","placeholder","MM/YY","formControlName","expiryDate",1,"form-control",3,"input"],["for","cvc"],["type","text","id","cvc","name","cvc","placeholder","CVC","formControlName","cvv",1,"form-control"],["for","name"],["type","text","id","name","name","name","formControlName","cardHolderName",1,"form-control"],["for","address"],["type","text","id","address","name","address","formControlName","address",1,"form-control",3,"placeholder"],["for","city"],["id","city","name","city","formControlName","city",1,"form-control"],[3,"value"],["for","zip"],["type","text","id","zip","name","zip","formControlName","zipCode",1,"form-control"],["for","comment"],["id","comment","name","comment","formControlName","comment",1,"form-control"],["type","submit",1,"primary-btn",3,"click","appLangClass"]],template:function(d,e){d&1&&(a(0,"div",0)(1,"div",1)(2,"div")(3,"h5",2),l(4),p(5,"translate"),n(),a(6,"p",2),l(7),p(8,"translate"),n()(),I(9,oe,5,3,"div",null,S),_(11,"hr"),a(12,"div")(13,"h6",2),l(14),p(15,"translate"),n(),a(16,"p",3),l(17),n()()(),a(18,"form",4),b("ngSubmit",function(){return e.onSubmit()}),a(19,"h5",2),l(20),p(21,"translate"),n(),a(22,"p"),l(23),p(24,"translate"),n(),a(25,"div",5)(26,"label",6),l(27),p(28,"translate"),n(),a(29,"input",7),b("input",function(x){return e.formatCardNumber(x)}),n(),C(30,le,3,3,"small")(31,pe,3,3,"small"),n(),a(32,"div",8)(33,"div",5)(34,"label",9),l(35),p(36,"translate"),n(),a(37,"input",10),b("input",function(x){return e.formatExpiryDate(x)}),n(),C(38,ce,3,3,"small")(39,de,3,3,"small"),n(),a(40,"div",5)(41,"label",11),l(42),p(43,"translate"),n(),_(44,"input",12),C(45,me,3,3,"small")(46,se,3,3,"small"),n()(),a(47,"div",5)(48,"label",13),l(49),p(50,"translate"),n(),_(51,"input",14),C(52,ue,3,3,"small"),n(),a(53,"div",5)(54,"label",15),l(55),p(56,"translate"),n(),_(57,"input",16),p(58,"translate"),n(),a(59,"div",8)(60,"div",5)(61,"label",17),l(62),p(63,"translate"),n(),a(64,"select",18),I(65,ve,3,2,"option",19,S),n()(),a(67,"div",5)(68,"label",20),l(69),p(70,"translate"),n(),_(71,"input",21),C(72,Ce,3,3,"small")(73,fe,3,3,"small"),n()(),a(74,"div",5)(75,"label",22),l(76),p(77,"translate"),n(),_(78,"textarea",23),n(),a(79,"button",24),b("click",function(){return e.scrollOnTop()}),a(80,"span"),l(81),p(82,"translate"),n()()()()),d&2&&(i(3),g("appLangClass","geo-primary, eng-primary, ru-primary"),i(),m(c(5,31,"cart.title")),i(2),g("appLangClass","geo-secondary, eng-secondary, ru-secondary"),i(),O("",e.getTotalQuantity()," ",c(8,33,"cart.items"),""),i(2),M(e.cartItems),i(4),g("appLangClass","geo-secondary, eng-secondary, ru-secondary"),i(),m(c(15,35,"cart.total")),i(3),s("",e.getTotalAmount()," \u20BE"),i(),g("formGroup",e.checkoutForm)("appLangClass","geo-secondary, eng-secondary, ru-secondary"),i(),g("appLangClass","geo-primary, eng-primary, ru-primary"),i(),s(" ",c(21,37,"checkout.title")," "),i(3),s(" ",c(24,39,"checkout.description")," "),i(4),m(c(28,41,"checkout.card-number")),i(3),f(e.cardNumber!=null&&e.cardNumber.touched&&(!(e.cardNumber==null||e.cardNumber.errors==null)&&e.cardNumber.errors.required)?30:e.cardNumber!=null&&e.cardNumber.dirty&&(!(e.cardNumber==null||e.cardNumber.errors==null)&&e.cardNumber.errors.pattern)?31:-1),i(5),m(c(36,43,"checkout.expiry-date")),i(3),f(e.expiryDate!=null&&e.expiryDate.touched&&(!(e.expiryDate==null||e.expiryDate.errors==null)&&e.expiryDate.errors.required)?38:e.expiryDate!=null&&e.expiryDate.dirty&&(!(e.expiryDate==null||e.expiryDate.errors==null)&&e.expiryDate.errors.pattern)?39:-1),i(4),m(c(43,45,"checkout.cvc")),i(3),f(e.cvv!=null&&e.cvv.touched&&(!(e.cvv==null||e.cvv.errors==null)&&e.cvv.errors.required)?45:e.cvv!=null&&e.cvv.dirty&&(!(e.cvv==null||e.cvv.errors==null)&&e.cvv.errors.pattern)?46:-1),i(4),s(" ",c(50,47,"checkout.name")," "),i(3),f(e.name!=null&&e.name.touched&&(!(e.name==null||e.name.errors==null)&&e.name.errors.required)?52:-1),i(3),s(" ",c(56,49,"checkout.address")," "),i(2),g("placeholder",c(58,51,"checkout.address-placeholder")),i(5),s(" ",c(63,53,"checkout.city")," "),i(3),M(e.cities),i(4),s(" ",c(70,55,"checkout.zip")," "),i(3),f(e.zip!=null&&e.zip.touched&&(!(e.zip==null||e.zip.errors==null)&&e.zip.errors.required)?72:e.zip!=null&&e.zip.dirty&&(!(e.zip==null||e.zip.errors==null)&&e.zip.errors.pattern)?73:-1),i(4),s(" ",c(77,57,"checkout.comment")," "),i(3),T("is-disabled",e.checkoutForm.invalid),g("appLangClass","geo-primary, eng-primary, ru-primary"),i(2),s(" ",c(82,59,"checkout.submit")," "))},dependencies:[L,j,V,Z,Q,J,K,G,Y,H,A,W,R,U],styles:[".wrapper[_ngcontent-%COMP%]{min-height:calc(100vh - 358px);padding:70px 20px 0;display:flex;flex-direction:column;gap:20px;align-items:center}.wrapper[_ngcontent-%COMP%] > .receipt[_ngcontent-%COMP%]{padding:20px;width:100%;max-width:345px;aspect-ratio:1/1;border-radius:35px;border:2px solid #4c0027;display:flex;flex-direction:column;justify-content:space-around}.wrapper[_ngcontent-%COMP%] > .receipt[_ngcontent-%COMP%] > hr[_ngcontent-%COMP%]{border:2px solid #4c0027;border-radius:5px}.wrapper[_ngcontent-%COMP%] > .receipt[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.wrapper[_ngcontent-%COMP%] > .receipt[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .wrapper[_ngcontent-%COMP%] > .receipt[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{margin:0}.wrapper[_ngcontent-%COMP%] > .receipt[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%;padding:10px 20px;background-color:#4c0027;border:none;border-radius:5px;color:#fff;font-weight:700;cursor:pointer;transition:.3s}.wrapper[_ngcontent-%COMP%] > .receipt[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{opacity:.8}.wrapper[_ngcontent-%COMP%] > form[_ngcontent-%COMP%]{width:100%;max-width:345px}.wrapper[_ngcontent-%COMP%] > form[_ngcontent-%COMP%] > .form-group[_ngcontent-%COMP%]{width:100%}.wrapper[_ngcontent-%COMP%] > form[_ngcontent-%COMP%]   .split[_ngcontent-%COMP%]{display:flex;gap:20px}@media screen and (min-width: 768px){.wrapper[_ngcontent-%COMP%]{padding:40px 60px 0;min-height:calc(100vh - 436px)}}@media screen and (min-width: 1024px){.wrapper[_ngcontent-%COMP%]{padding:40px 80px 0;flex-direction:row;justify-content:center;gap:60px}}@media screen and (min-width: 1920px){.wrapper[_ngcontent-%COMP%]{min-height:calc(100vh - 474px);padding:40px 12% 0;gap:100px}.wrapper[_ngcontent-%COMP%] > form[_ngcontent-%COMP%]{width:50%;max-width:50%}.wrapper[_ngcontent-%COMP%] > form[_ngcontent-%COMP%] > .split[_ngcontent-%COMP%] > .form-group[_ngcontent-%COMP%]{width:50%}}"]});let t=o;return t})();export{Ee as CheckoutComponent};
