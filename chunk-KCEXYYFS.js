import{a as te}from"./chunk-DODT3KDT.js";import{a as ee}from"./chunk-GZLBYBNT.js";import{a as G,b as s,c as H,d as A,f as Q,h as R,k as U,l as Y,m as J,n as K,o as W,p as X,r as Z}from"./chunk-SA34UV6Y.js";import"./chunk-SHF2QPEZ.js";import{e as z}from"./chunk-H3Z4EEUF.js";import{t as q}from"./chunk-Y6STU5OE.js";import{a as $,b as V}from"./chunk-UW3LFFGE.js";import{c as j,d as L}from"./chunk-AKL4WKOJ.js";import{Db as l,Eb as c,Fb as y,Gb as P,Mb as F,Oa as t,Pa as C,Pb as p,Qb as d,Z as N,_a as v,a as E,ab as h,ca as D,cb as g,e as w,eb as f,fa as B,fb as I,gb as M,hb as O,ib as r,jb as n,kb as _,sb as k,tb as S,wb as T}from"./chunk-FZWOQZIM.js";var ie=(()=>{let o=class o{constructor(a){this.http=a,this.jsonUrl="assets/cities/cities.json"}getCities(){return this.http.get(this.jsonUrl)}};o.\u0275fac=function(m){return new(m||o)(D(q))},o.\u0275prov=N({token:o,factory:o.\u0275fac,providedIn:"root"});let i=o;return i})();function le(i,o){if(i&1&&(r(0,"div")(1,"h6",3),l(2),n(),r(3,"p",3),l(4),n()()),i&2){let u=o.$implicit;t(2),P("",u.wine.name," ",u.quantity,"x"),t(2),y("",u.wine.price*u.quantity," \u20BE")}}function oe(i,o){i&1&&(r(0,"small"),l(1),p(2,"translate"),n()),i&2&&(t(),c(d(2,1,"auth.required-field")))}function pe(i,o){i&1&&(r(0,"small"),l(1),p(2,"translate"),n()),i&2&&(t(),c(d(2,1,"auth.invalid-field")))}function de(i,o){i&1&&(r(0,"small"),l(1),p(2,"translate"),n()),i&2&&(t(),c(d(2,1,"auth.required-field")))}function ce(i,o){i&1&&(r(0,"small"),l(1),p(2,"translate"),n()),i&2&&(t(),c(d(2,1,"auth.invalid-field")))}function me(i,o){i&1&&(r(0,"small"),l(1),p(2,"translate"),n()),i&2&&(t(),c(d(2,1,"auth.required-field")))}function se(i,o){i&1&&(r(0,"small"),l(1),p(2,"translate"),n()),i&2&&(t(),c(d(2,1,"auth.invalid-field")))}function ue(i,o){i&1&&(r(0,"small"),l(1),p(2,"translate"),n()),i&2&&(t(),c(d(2,1,"auth.required-field")))}function he(i,o){i&1&&(r(0,"small"),l(1),p(2,"translate"),n()),i&2&&(t(),c(d(2,1,"auth.required-field")))}function ve(i,o){if(i&1&&l(0),i&2){let u=S().$implicit;y(" ",u.name_ka," ")}}function ge(i,o){if(i&1&&l(0),i&2){let u=S().$implicit;y(" ",u.name_en," ")}}function fe(i,o){if(i&1&&(r(0,"option",20),v(1,ve,1,1)(2,ge,1,1),n()),i&2){let u=o.$implicit,a=S();T("value",u.name_ka),t(),f(a.isGeorgian?1:2)}}function Ce(i,o){i&1&&(r(0,"small"),l(1),p(2,"translate"),n()),i&2&&(t(),c(d(2,1,"auth.required-field")))}function _e(i,o){i&1&&(r(0,"small"),l(1),p(2,"translate"),n()),i&2&&(t(),c(d(2,1,"auth.invalid-field")))}var Ne=(()=>{let o=class o{constructor(a,m,e,b,x,ne){this.cartService=a,this.fb=m,this.orderService=e,this.citiesService=b,this.languageService=x,this.router=ne,this.cartItems=[],this.cities=[],this.isGeorgian=!1,this.subscription=new w}ngOnInit(){this.getCartItems(),this.initCheckoutForm(),this.getCities(),this.checkLanguage()}ngOnDestroy(){this.subscription.unsubscribe()}onSubmit(){let a=E({},this.checkoutForm.value);delete a.cardHolderName,delete a.cardNumber,delete a.cvv,delete a.expiryDate,this.subscription.add(this.orderService.addOrder(a).subscribe(()=>{this.cartService.clearCart(),this.router.navigate(["/checkout-success"])},m=>console.error(m)))}formatCardNumber(a){let m=a.target,e=m.value.replace(/\D/g,"");e.length>0&&(e=e.match(/.{1,4}/g)?.join(" ")??e),m.value=e,this.checkoutForm.get("cardNumber")?.setValue(e)}formatExpiryDate(a){let e=a.target.value.replace(/\D/g,"");e.length>=2&&(e=e.substring(0,2)+"/"+e.substring(2,4)),this.checkoutForm.get("expiryDate")?.setValue(e)}getTotalAmount(){return this.cartItems.reduce((a,m)=>a+m.wine.price*m.quantity,0)}scrollOnTop(){window.scrollTo({top:0,behavior:"smooth"})}getTotalQuantity(){return this.cartItems.reduce((a,m)=>a+m.quantity,0)}get cardNumber(){return this.checkoutForm.get("cardNumber")}get expiryDate(){return this.checkoutForm.get("expiryDate")}get cvv(){return this.checkoutForm.get("cvv")}get cardHolderName(){return this.checkoutForm.get("cardHolderName")}get address(){return this.checkoutForm.get("address")}get zip(){return this.checkoutForm.get("zipCode")}get name(){return this.checkoutForm.get("cardHolderName")}getCartItems(){this.subscription.add(this.cartService.cartItems$.subscribe(a=>{this.cartItems=a}))}initCheckoutForm(){this.checkoutForm=this.fb.group({cardNumber:["",[s.required,s.pattern(/^\d{4} \d{4} \d{4} \d{4}$/)]],expiryDate:["",[s.required,s.pattern(/^\d{2}\/\d{2}$/)]],cvv:["",[s.required,s.pattern(/^\d{3}$/)]],cardHolderName:["",[s.required]],address:["",[s.required]],city:["",s.required],zipCode:["",[s.required,s.pattern(/^\d{4}$/)]],comment:[""],items:this.fb.array(this.cartItems.map(a=>this.fb.group({wineId:a.wine.id,quantity:a.quantity})))})}getCities(){this.subscription.add(this.citiesService.getCities().subscribe(a=>{this.cities=a.cities},a=>console.error(a)))}checkLanguage(){this.subscription.add(this.languageService.language$.subscribe(a=>{this.isGeorgian=a==="geo"}))}};o.\u0275fac=function(m){return new(m||o)(C(te),C(X),C(ee),C(ie),C($),C(z))},o.\u0275cmp=B({type:o,selectors:[["app-checkout"]],standalone:!0,features:[F],decls:87,vars:77,consts:[[1,"wrapper"],[1,"receipt"],[3,"appLangClass"],[1,"eng-primary"],[3,"ngSubmit","formGroup","appLangClass"],[1,"form-group"],["for","card-number"],["type","text","id","card-number","name","card-number","formControlName","cardNumber","placeholder","1234 1234 1234 1234","maxlength","19","onkeydown","return event.key >= '0' && event.key <= '9' || event.key === 'Backspace'","autocomplete","cc-number",1,"form-control",3,"input"],[1,"split"],["for","expiry-date"],["type","text","id","expiry-date","name","expiry-date","placeholder","MM/YY","formControlName","expiryDate","autocomplete","cc-exp",1,"form-control",3,"input"],["for","cvc"],["type","text","id","cvc","name","cvc","placeholder","CVC","formControlName","cvv","autocomplete","cc-csc",1,"form-control"],["for","name"],["type","text","id","name","name","name","formControlName","cardHolderName","autocomplete","cc-name",1,"form-control"],["for","address"],["type","text","id","address","name","address","formControlName","address","autocomplete","address-line1",1,"form-control",3,"placeholder"],["for","city"],["id","city","name","city","formControlName","city","autocomplete","address-level2",1,"form-control"],["value","","disabled","","selected",""],[3,"value"],["for","zip"],["type","text","id","zip","name","zip","formControlName","zipCode","autocomplete","postal-code",1,"form-control"],["for","comment"],["id","comment","name","comment","formControlName","comment","autocomplete","off",1,"form-control",3,"placeholder"],["type","submit",1,"primary-btn",3,"click","appLangClass"]],template:function(m,e){m&1&&(r(0,"div",0)(1,"div",1)(2,"div")(3,"h5",2),l(4),p(5,"translate"),n(),r(6,"p",2),l(7),p(8,"translate"),n()(),M(9,le,5,3,"div",null,I),_(11,"hr"),r(12,"div")(13,"h6",2),l(14),p(15,"translate"),n(),r(16,"p",3),l(17),n()()(),r(18,"form",4),k("ngSubmit",function(){return e.onSubmit()}),r(19,"h5",2),l(20),p(21,"translate"),n(),r(22,"p"),l(23),p(24,"translate"),n(),r(25,"div",5)(26,"label",6),l(27),p(28,"translate"),n(),r(29,"input",7),k("input",function(x){return e.formatCardNumber(x)}),n(),v(30,oe,3,3,"small")(31,pe,3,3,"small"),n(),r(32,"div",8)(33,"div",5)(34,"label",9),l(35),p(36,"translate"),n(),r(37,"input",10),k("input",function(x){return e.formatExpiryDate(x)}),n(),v(38,de,3,3,"small")(39,ce,3,3,"small"),n(),r(40,"div",5)(41,"label",11),l(42),p(43,"translate"),n(),_(44,"input",12),v(45,me,3,3,"small")(46,se,3,3,"small"),n()(),r(47,"div",5)(48,"label",13),l(49),p(50,"translate"),n(),_(51,"input",14),v(52,ue,3,3,"small"),n(),r(53,"div",5)(54,"label",15),l(55),p(56,"translate"),n(),_(57,"input",16),p(58,"translate"),v(59,he,3,3,"small"),n(),r(60,"div",8)(61,"div",5)(62,"label",17),l(63),p(64,"translate"),n(),r(65,"select",18)(66,"option",19),l(67,"\u10D0\u10D8\u10E0\u10E9\u10D8\u10D4"),n(),M(68,fe,3,2,"option",20,I),n()(),r(70,"div",5)(71,"label",21),l(72),p(73,"translate"),n(),_(74,"input",22),v(75,Ce,3,3,"small")(76,_e,3,3,"small"),n()(),r(77,"div",5)(78,"label",23),l(79),p(80,"translate"),n(),_(81,"textarea",24),p(82,"translate"),n(),r(83,"button",25),k("click",function(){return e.scrollOnTop()}),r(84,"span"),l(85),p(86,"translate"),n()()()()),m&2&&(t(3),h("appLangClass","geo-primary, eng-primary, ru-primary"),t(),c(d(5,45,"cart.title")),t(2),h("appLangClass","geo-secondary, eng-secondary, ru-secondary"),t(),P("",e.getTotalQuantity()," ",d(8,47,"cart.items"),""),t(2),O(e.cartItems),t(4),h("appLangClass","geo-secondary, eng-secondary, ru-secondary"),t(),c(d(15,49,"cart.total")),t(3),y("",e.getTotalAmount()," \u20BE"),t(),h("formGroup",e.checkoutForm)("appLangClass","geo-secondary, eng-secondary, ru-secondary"),t(),h("appLangClass","geo-primary, eng-primary, ru-primary"),t(),y(" ",d(21,51,"checkout.title")," "),t(3),y(" ",d(24,53,"checkout.description")," "),t(4),c(d(28,55,"checkout.card-number")),t(2),g("is-invalid",(e.cardNumber==null?null:e.cardNumber.touched)&&(e.cardNumber==null?null:e.cardNumber.invalid)),t(),f(e.cardNumber!=null&&e.cardNumber.touched&&(!(e.cardNumber==null||e.cardNumber.errors==null)&&e.cardNumber.errors.required)?30:e.cardNumber!=null&&e.cardNumber.dirty&&(!(e.cardNumber==null||e.cardNumber.errors==null)&&e.cardNumber.errors.pattern)?31:-1),t(5),c(d(36,57,"checkout.expiry-date")),t(2),g("is-invalid",(e.expiryDate==null?null:e.expiryDate.touched)&&(e.expiryDate==null?null:e.expiryDate.invalid)),t(),f(e.expiryDate!=null&&e.expiryDate.touched&&(!(e.expiryDate==null||e.expiryDate.errors==null)&&e.expiryDate.errors.required)?38:e.expiryDate!=null&&e.expiryDate.dirty&&(!(e.expiryDate==null||e.expiryDate.errors==null)&&e.expiryDate.errors.pattern)?39:-1),t(4),c(d(43,59,"checkout.cvc")),t(2),g("is-invalid",(e.cvv==null?null:e.cvv.touched)&&(e.cvv==null?null:e.cvv.invalid)),t(),f(e.cvv!=null&&e.cvv.touched&&(!(e.cvv==null||e.cvv.errors==null)&&e.cvv.errors.required)?45:e.cvv!=null&&e.cvv.dirty&&(!(e.cvv==null||e.cvv.errors==null)&&e.cvv.errors.pattern)?46:-1),t(4),c(d(50,61,"checkout.name")),t(2),g("is-invalid",(e.name==null?null:e.name.touched)&&(e.name==null?null:e.name.invalid)),t(),f(e.name!=null&&e.name.touched&&(!(e.name==null||e.name.errors==null)&&e.name.errors.required)?52:-1),t(3),c(d(56,63,"checkout.address")),t(2),g("is-invalid",(e.address==null?null:e.address.touched)&&(e.address==null?null:e.address.invalid)),h("placeholder",d(58,65,"checkout.address-placeholder")),t(2),f(e.address!=null&&e.address.touched&&(!(e.address==null||e.address.errors==null)&&e.address.errors.required)?59:-1),t(4),c(d(64,67,"checkout.city")),t(5),O(e.cities),t(4),c(d(73,69,"checkout.zip")),t(2),g("is-invalid",(e.zip==null?null:e.zip.touched)&&(e.zip==null?null:e.zip.invalid)),t(),f(e.zip!=null&&e.zip.touched&&(!(e.zip==null||e.zip.errors==null)&&e.zip.errors.required)?75:e.zip!=null&&e.zip.dirty&&(!(e.zip==null||e.zip.errors==null)&&e.zip.errors.pattern)?76:-1),t(4),c(d(80,71,"checkout.comment")),t(2),h("placeholder",d(82,73,"checkout.comment-placeholder")),t(2),g("is-disabled",e.checkoutForm.invalid),h("appLangClass","geo-primary, eng-primary, ru-primary"),t(2),c(d(86,75,"checkout.submit")))},dependencies:[L,j,V,Z,Q,J,K,G,Y,H,A,W,R,U],styles:[".wrapper[_ngcontent-%COMP%]{min-height:calc(100vh - 358px);padding:70px 20px 0;display:flex;flex-direction:column;gap:20px;align-items:center}.wrapper[_ngcontent-%COMP%] > .receipt[_ngcontent-%COMP%]{padding:20px;width:100%;max-width:345px;aspect-ratio:1/1;border-radius:35px;border:2px solid #4c0027;display:flex;flex-direction:column;justify-content:space-around}.wrapper[_ngcontent-%COMP%] > .receipt[_ngcontent-%COMP%] > hr[_ngcontent-%COMP%]{border:2px solid #4c0027;border-radius:5px}.wrapper[_ngcontent-%COMP%] > .receipt[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.wrapper[_ngcontent-%COMP%] > .receipt[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .wrapper[_ngcontent-%COMP%] > .receipt[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{margin:0}.wrapper[_ngcontent-%COMP%] > .receipt[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%;padding:10px 20px;background-color:#4c0027;border:none;border-radius:5px;color:#fff;font-weight:700;cursor:pointer;transition:.3s}.wrapper[_ngcontent-%COMP%] > .receipt[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{opacity:.8}.wrapper[_ngcontent-%COMP%] > form[_ngcontent-%COMP%]{width:100%;max-width:345px}.wrapper[_ngcontent-%COMP%] > form[_ngcontent-%COMP%] > .form-group[_ngcontent-%COMP%]{width:100%}.wrapper[_ngcontent-%COMP%] > form[_ngcontent-%COMP%]   .split[_ngcontent-%COMP%]{display:flex;gap:20px}@media screen and (min-width: 768px){.wrapper[_ngcontent-%COMP%]{padding:40px 60px 0;min-height:calc(100vh - 436px)}}@media screen and (min-width: 1024px){.wrapper[_ngcontent-%COMP%]{padding:40px 80px 0;flex-direction:row;justify-content:center;gap:60px}}@media screen and (min-width: 1920px){.wrapper[_ngcontent-%COMP%]{min-height:calc(100vh - 474px);padding:40px 12% 0;gap:100px}.wrapper[_ngcontent-%COMP%] > form[_ngcontent-%COMP%]{width:50%;max-width:50%}.wrapper[_ngcontent-%COMP%] > form[_ngcontent-%COMP%] > .split[_ngcontent-%COMP%] > .form-group[_ngcontent-%COMP%]{width:50%}}"]});let i=o;return i})();export{Ne as CheckoutComponent};
