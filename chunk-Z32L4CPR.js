import{a as g}from"./chunk-OKL6TN3N.js";import{e as p}from"./chunk-JJN6UOWY.js";import{t as h}from"./chunk-WH2QT74X.js";import{V as c,Z as l,ca as a,k as d}from"./chunk-MOSC54PF.js";var n=class extends Error{};n.prototype.name="InvalidTokenError";function f(o){return decodeURIComponent(atob(o).replace(/(.)/g,(t,i)=>{let e=i.charCodeAt(0).toString(16).toUpperCase();return e.length<2&&(e="0"+e),"%"+e}))}function m(o){let t=o.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return f(t)}catch{return atob(t)}}function u(o,t){if(typeof o!="string")throw new n("Invalid token specified: must be a string");t||(t={});let i=t.header===!0?0:1,e=o.split(".")[i];if(typeof e!="string")throw new n(`Invalid token specified: missing part #${i+1}`);let r;try{r=m(e)}catch(s){throw new n(`Invalid token specified: invalid base64 for part #${i+1} (${s.message})`)}try{return JSON.parse(r)}catch(s){throw new n(`Invalid token specified: invalid json for part #${i+1} (${s.message})`)}}var y=(()=>{let t=class t{constructor(e,r,s){this.http=e,this.router=r,this.loadingService=s,this.apiUrl="https://sazanowine-api-dev.azurewebsites.net/api/identity",this.loggedInStatus=new d(this.checkToken())}registerUser(e){return this.loadingService.show(),this.http.post(`${this.apiUrl}/register`,e).pipe(c({next:()=>this.loadingService.hide(),error:()=>this.loadingService.hide()}))}loginUser(e){return this.loadingService.show(),this.http.post(`${this.apiUrl}/login`,e).pipe(c({next:r=>{this.loadingService.hide(),r&&r.token&&(localStorage.setItem("token",r.token),this.loggedInStatus.next(!0))},error:()=>this.loadingService.hide()}))}logout(){localStorage.removeItem("token"),this.loggedInStatus.next(!1),this.router.navigate(["/"])}isLoggedIn(){return this.loggedInStatus.asObservable()}decodeToken(){let e=localStorage.getItem("token");if(e)try{return u(e)}catch(r){return console.error("Error decoding token",r),null}return null}isTokenExpired(){let e=this.decodeToken();if(e&&e.exp){let r=new Date(0);return r.setUTCSeconds(e.exp),r<new Date}return!0}isUserAdmin(){let e=this.decodeToken();return e&&Array.isArray(e.roles)?e.roles.includes("Admin"):!1}checkToken(){return!!localStorage.getItem("token")}};t.\u0275fac=function(r){return new(r||t)(a(h),a(p),a(g))},t.\u0275prov=l({token:t,factory:t.\u0275fac,providedIn:"root"});let o=t;return o})();export{y as a};
