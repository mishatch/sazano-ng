import{a as te}from"./chunk-E3D2QGJ5.js";import{a as ee}from"./chunk-QIJAE5W3.js";import{a as G,b as s,c as H,d as A,f as Q,h as R,i as U,j as Y,k as J,l as K,m as W,n as X,p as Z}from"./chunk-LSYD3J5U.js";import"./chunk-OKL6TN3N.js";import{e as z}from"./chunk-JJN6UOWY.js";import{t as q}from"./chunk-WH2QT74X.js";import{a as $,b as V}from"./chunk-4ULCVYXL.js";import{c as j,d as L}from"./chunk-CKQWD7NW.js";import{Cb as o,Db as d,Eb as _,Fb as O,Lb as F,Oa as i,Ob as p,Pa as f,Pb as c,Z as P,_a as g,a as E,ab as h,ca as N,cb as D,e as w,eb as v,fa as B,fb as S,gb as I,hb as M,ib as r,jb as n,kb as C,sb as b,tb as k,wb as T}from"./chunk-MOSC54PF.js";var ie=(()=>{let l=class l{constructor(a){this.http=a,this.jsonUrl="assets/cities/cities.json"}getCities(){return this.http.get(this.jsonUrl)}};l.\u0275fac=function(m){return new(m||l)(N(q))},l.\u0275prov=P({token:l,factory:l.\u0275fac,providedIn:"root"});let t=l;return t})();function oe(t,l){if(t&1&&(r(0,"div")(1,"h6",3),o(2),n(),r(3,"p",3),o(4),n()()),t&2){let u=l.$implicit;i(2),O("",u.wine.name," ",u.quantity,"x"),i(2),_("",u.wine.price*u.quantity," \u20BE")}}function le(t,l){t&1&&(r(0,"small"),o(1),p(2,"translate"),n()),t&2&&(i(),d(c(2,1,"auth.required-field")))}function pe(t,l){t&1&&(r(0,"small"),o(1),p(2,"translate"),n()),t&2&&(i(),d(c(2,1,"auth.invalid-field")))}function ce(t,l){t&1&&(r(0,"small"),o(1),p(2,"translate"),n()),t&2&&(i(),d(c(2,1,"auth.required-field")))}function de(t,l){t&1&&(r(0,"small"),o(1),p(2,"translate"),n()),t&2&&(i(),d(c(2,1,"auth.invalid-field")))}function me(t,l){t&1&&(r(0,"small"),o(1),p(2,"translate"),n()),t&2&&(i(),d(c(2,1,"auth.required-field")))}function se(t,l){t&1&&(r(0,"small"),o(1),p(2,"translate"),n()),t&2&&(i(),d(c(2,1,"auth.invalid-field")))}function ue(t,l){t&1&&(r(0,"small"),o(1),p(2,"translate"),n()),t&2&&(i(),d(c(2,1,"auth.required-field")))}function he(t,l){t&1&&(r(0,"small"),o(1),p(2,"translate"),n()),t&2&&(i(),d(c(2,1,"auth.required-field")))}function ge(t,l){if(t&1&&o(0),t&2){let u=k().$implicit;_(" ",u.name_ka," ")}}function ve(t,l){if(t&1&&o(0),t&2){let u=k().$implicit;_(" ",u.name_en," ")}}function fe(t,l){if(t&1&&(r(0,"option",20),g(1,ge,1,1)(2,ve,1,1),n()),t&2){let u=l.$implicit,a=k();T("value",u.name_ka),i(),v(a.isGeorgian?1:2)}}function Ce(t,l){t&1&&(r(0,"small"),o(1),p(2,"translate"),n()),t&2&&(i(),d(c(2,1,"auth.required-field")))}function _e(t,l){t&1&&(r(0,"small"),o(1),p(2,"translate"),n()),t&2&&(i(),d(c(2,1,"auth.invalid-field")))}var Ne=(()=>{let l=class l{constructor(a,m,e,y,x,ne){this.cartService=a,this.fb=m,this.orderService=e,this.citiesService=y,this.languageService=x,this.router=ne,this.cartItems=[],this.cities=[],this.isGeorgian=!1,this.subscription=new w}ngOnInit(){this.getCartItems(),this.initCheckoutForm(),this.getCities(),this.checkLanguage()}ngOnDestroy(){this.subscription.unsubscribe()}onSubmit(){let a=E({},this.checkoutForm.value);delete a.cardHolderName,delete a.cardNumber,delete a.cvv,delete a.expiryDate,this.subscription.add(this.orderService.addOrder(a).subscribe(()=>{this.cartService.clearCart(),this.router.navigate(["/checkout-success"])},m=>console.error(m)))}formatCardNumber(a){let m=a.target,e=m.value.replace(/\D/g,"");e.length>0&&(e=e.match(/.{1,4}/g)?.join(" ")??e),m.value=e,this.checkoutForm.get("cardNumber")?.setValue(e)}formatExpiryDate(a){let e=a.target.value.replace(/\D/g,"");e.length>=2&&(e=e.substring(0,2)+"/"+e.substring(2,4)),this.checkoutForm.get("expiryDate")?.setValue(e)}getTotalAmount(){return this.cartItems.reduce((a,m)=>a+m.wine.price*m.quantity,0)}scrollOnTop(){window.scrollTo({top:0,behavior:"smooth"})}getTotalQuantity(){return this.cartItems.reduce((a,m)=>a+m.quantity,0)}get cardNumber(){return this.checkoutForm.get("cardNumber")}get expiryDate(){return this.checkoutForm.get("expiryDate")}get cvv(){return this.checkoutForm.get("cvv")}get cardHolderName(){return this.checkoutForm.get("cardHolderName")}get address(){return this.checkoutForm.get("address")}get zip(){return this.checkoutForm.get("zipCode")}get name(){return this.checkoutForm.get("cardHolderName")}getCartItems(){this.subscription.add(this.cartService.cartItems$.subscribe(a=>{this.cartItems=a}))}initCheckoutForm(){this.checkoutForm=this.fb.group({cardNumber:["",[s.required,s.pattern(/^\d{4} \d{4} \d{4} \d{4}$/)]],expiryDate:["",[s.required,s.pattern(/^\d{2}\/\d{2}$/)]],cvv:["",[s.required,s.pattern(/^\d{3}$/)]],cardHolderName:["",[s.required]],address:["",[s.required]],city:["",s.required],zipCode:["",[s.required,s.pattern(/^\d{4}$/)]],comment:[""],items:this.fb.array(this.cartItems.map(a=>this.fb.group({wineId:a.wine.id,quantity:a.quantity})))})}getCities(){this.subscription.add(this.citiesService.getCities().subscribe(a=>{this.cities=a.cities},a=>console.error(a)))}checkLanguage(){this.subscription.add(this.languageService.language$.subscribe(a=>{this.isGeorgian=a==="geo"}))}};l.\u0275fac=function(m){return new(m||l)(f(te),f(X),f(ee),f(ie),f($),f(z))},l.\u0275cmp=B({type:l,selectors:[["app-checkout"]],standalone:!0,features:[F],decls:87,vars:65,consts:[[1,"wrapper"],[1,"receipt"],[3,"appLangClass"],[1,"eng-primary"],[3,"ngSubmit","formGroup","appLangClass"],[1,"form-group"],["for","card-number"],["type","text","id","card-number","name","card-number","formControlName","cardNumber","placeholder","1234 1234 1234 1234","maxlength","19","onkeydown","return event.key >= '0' && event.key <= '9' || event.key === 'Backspace'","autocomplete","cc-number",1,"form-control",3,"input"],[1,"split"],["for","expiry-date"],["type","text","id","expiry-date","name","expiry-date","placeholder","MM/YY","formControlName","expiryDate","autocomplete","cc-exp",1,"form-control",3,"input"],["for","cvc"],["type","text","id","cvc","name","cvc","placeholder","CVC","formControlName","cvv","autocomplete","cc-csc",1,"form-control"],["for","name"],["type","text","id","name","name","name","formControlName","cardHolderName","autocomplete","cc-name",1,"form-control"],["for","address"],["type","text","id","address","name","address","formControlName","address","autocomplete","address-line1",1,"form-control",3,"placeholder"],["for","city"],["id","city","name","city","formControlName","city","autocomplete","address-level2",1,"form-control"],["value","","disabled","","selected",""],[3,"value"],["for","zip"],["type","text","id","zip","name","zip","formControlName","zipCode","autocomplete","postal-code",1,"form-control"],["for","comment"],["id","comment","name","comment","formControlName","comment","autocomplete","off",1,"form-control",3,"placeholder"],["type","submit",1,"primary-btn",3,"click","appLangClass"]],template:function(m,e){m&1&&(r(0,"div",0)(1,"div",1)(2,"div")(3,"h5",2),o(4),p(5,"translate"),n(),r(6,"p",2),o(7),p(8,"translate"),n()(),I(9,oe,5,3,"div",null,S),C(11,"hr"),r(12,"div")(13,"h6",2),o(14),p(15,"translate"),n(),r(16,"p",3),o(17),n()()(),r(18,"form",4),b("ngSubmit",function(){return e.onSubmit()}),r(19,"h5",2),o(20),p(21,"translate"),n(),r(22,"p"),o(23),p(24,"translate"),n(),r(25,"div",5)(26,"label",6),o(27),p(28,"translate"),n(),r(29,"input",7),b("input",function(x){return e.formatCardNumber(x)}),n(),g(30,le,3,3,"small")(31,pe,3,3,"small"),n(),r(32,"div",8)(33,"div",5)(34,"label",9),o(35),p(36,"translate"),n(),r(37,"input",10),b("input",function(x){return e.formatExpiryDate(x)}),n(),g(38,ce,3,3,"small")(39,de,3,3,"small"),n(),r(40,"div",5)(41,"label",11),o(42),p(43,"translate"),n(),C(44,"input",12),g(45,me,3,3,"small")(46,se,3,3,"small"),n()(),r(47,"div",5)(48,"label",13),o(49),p(50,"translate"),n(),C(51,"input",14),g(52,ue,3,3,"small"),n(),r(53,"div",5)(54,"label",15),o(55),p(56,"translate"),n(),C(57,"input",16),p(58,"translate"),g(59,he,3,3,"small"),n(),r(60,"div",8)(61,"div",5)(62,"label",17),o(63),p(64,"translate"),n(),r(65,"select",18)(66,"option",19),o(67,"\u10D0\u10D8\u10E0\u10E9\u10D8\u10D4"),n(),I(68,fe,3,2,"option",20,S),n()(),r(70,"div",5)(71,"label",21),o(72),p(73,"translate"),n(),C(74,"input",22),g(75,Ce,3,3,"small")(76,_e,3,3,"small"),n()(),r(77,"div",5)(78,"label",23),o(79),p(80,"translate"),n(),C(81,"textarea",24),p(82,"translate"),n(),r(83,"button",25),b("click",function(){return e.scrollOnTop()}),r(84,"span"),o(85),p(86,"translate"),n()()()()),m&2&&(i(3),h("appLangClass","geo-primary, eng-primary, ru-primary"),i(),d(c(5,33,"cart.title")),i(2),h("appLangClass","geo-secondary, eng-secondary, ru-secondary"),i(),O("",e.getTotalQuantity()," ",c(8,35,"cart.items"),""),i(2),M(e.cartItems),i(4),h("appLangClass","geo-secondary, eng-secondary, ru-secondary"),i(),d(c(15,37,"cart.total")),i(3),_("",e.getTotalAmount()," \u20BE"),i(),h("formGroup",e.checkoutForm)("appLangClass","geo-secondary, eng-secondary, ru-secondary"),i(),h("appLangClass","geo-primary, eng-primary, ru-primary"),i(),_(" ",c(21,39,"checkout.title")," "),i(3),_(" ",c(24,41,"checkout.description")," "),i(4),d(c(28,43,"checkout.card-number")),i(3),v(e.cardNumber!=null&&e.cardNumber.touched&&(!(e.cardNumber==null||e.cardNumber.errors==null)&&e.cardNumber.errors.required)?30:e.cardNumber!=null&&e.cardNumber.dirty&&(!(e.cardNumber==null||e.cardNumber.errors==null)&&e.cardNumber.errors.pattern)?31:-1),i(5),d(c(36,45,"checkout.expiry-date")),i(3),v(e.expiryDate!=null&&e.expiryDate.touched&&(!(e.expiryDate==null||e.expiryDate.errors==null)&&e.expiryDate.errors.required)?38:e.expiryDate!=null&&e.expiryDate.dirty&&(!(e.expiryDate==null||e.expiryDate.errors==null)&&e.expiryDate.errors.pattern)?39:-1),i(4),d(c(43,47,"checkout.cvc")),i(3),v(e.cvv!=null&&e.cvv.touched&&(!(e.cvv==null||e.cvv.errors==null)&&e.cvv.errors.required)?45:e.cvv!=null&&e.cvv.dirty&&(!(e.cvv==null||e.cvv.errors==null)&&e.cvv.errors.pattern)?46:-1),i(4),d(c(50,49,"checkout.name")),i(3),v(e.name!=null&&e.name.touched&&(!(e.name==null||e.name.errors==null)&&e.name.errors.required)?52:-1),i(3),d(c(56,51,"checkout.address")),i(2),h("placeholder",c(58,53,"checkout.address-placeholder")),i(2),v(e.address!=null&&e.address.touched&&(!(e.address==null||e.address.errors==null)&&e.address.errors.required)?59:-1),i(4),d(c(64,55,"checkout.city")),i(5),M(e.cities),i(4),d(c(73,57,"checkout.zip")),i(3),v(e.zip!=null&&e.zip.touched&&(!(e.zip==null||e.zip.errors==null)&&e.zip.errors.required)?75:e.zip!=null&&e.zip.dirty&&(!(e.zip==null||e.zip.errors==null)&&e.zip.errors.pattern)?76:-1),i(4),d(c(80,59,"checkout.comment")),i(2),h("placeholder",c(82,61,"checkout.comment-placeholder")),i(2),D("is-disabled",e.checkoutForm.invalid),h("appLangClass","geo-primary, eng-primary, ru-primary"),i(2),d(c(86,63,"checkout.submit")))},dependencies:[L,j,V,Z,Q,J,K,G,Y,H,A,W,R,U],styles:[".wrapper[_ngcontent-%COMP%]{min-height:calc(100vh - 358px);padding:70px 20px 0;display:flex;flex-direction:column;gap:20px;align-items:center}.wrapper[_ngcontent-%COMP%] > .receipt[_ngcontent-%COMP%]{padding:20px;width:100%;max-width:345px;aspect-ratio:1/1;border-radius:35px;border:2px solid #4c0027;display:flex;flex-direction:column;justify-content:space-around}.wrapper[_ngcontent-%COMP%] > .receipt[_ngcontent-%COMP%] > hr[_ngcontent-%COMP%]{border:2px solid #4c0027;border-radius:5px}.wrapper[_ngcontent-%COMP%] > .receipt[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.wrapper[_ngcontent-%COMP%] > .receipt[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .wrapper[_ngcontent-%COMP%] > .receipt[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{margin:0}.wrapper[_ngcontent-%COMP%] > .receipt[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%;padding:10px 20px;background-color:#4c0027;border:none;border-radius:5px;color:#fff;font-weight:700;cursor:pointer;transition:.3s}.wrapper[_ngcontent-%COMP%] > .receipt[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{opacity:.8}.wrapper[_ngcontent-%COMP%] > form[_ngcontent-%COMP%]{width:100%;max-width:345px}.wrapper[_ngcontent-%COMP%] > form[_ngcontent-%COMP%] > .form-group[_ngcontent-%COMP%]{width:100%}.wrapper[_ngcontent-%COMP%] > form[_ngcontent-%COMP%]   .split[_ngcontent-%COMP%]{display:flex;gap:20px}@media screen and (min-width: 768px){.wrapper[_ngcontent-%COMP%]{padding:40px 60px 0;min-height:calc(100vh - 436px)}}@media screen and (min-width: 1024px){.wrapper[_ngcontent-%COMP%]{padding:40px 80px 0;flex-direction:row;justify-content:center;gap:60px}}@media screen and (min-width: 1920px){.wrapper[_ngcontent-%COMP%]{min-height:calc(100vh - 474px);padding:40px 12% 0;gap:100px}.wrapper[_ngcontent-%COMP%] > form[_ngcontent-%COMP%]{width:50%;max-width:50%}.wrapper[_ngcontent-%COMP%] > form[_ngcontent-%COMP%] > .split[_ngcontent-%COMP%] > .form-group[_ngcontent-%COMP%]{width:50%}}"]});let t=l;return t})();export{Ne as CheckoutComponent};
