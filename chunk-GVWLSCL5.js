import{d as u}from"./chunk-CWRXWTAM.js";import{p}from"./chunk-AKPYVIKR.js";import{T as d,X as l,aa as s,k as c}from"./chunk-GJXFDQ6V.js";var i=class extends Error{};i.prototype.name="InvalidTokenError";function g(o){return decodeURIComponent(atob(o).replace(/(.)/g,(t,n)=>{let e=n.charCodeAt(0).toString(16).toUpperCase();return e.length<2&&(e="0"+e),"%"+e}))}function f(o){let t=o.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return g(t)}catch{return atob(t)}}function h(o,t){if(typeof o!="string")throw new i("Invalid token specified: must be a string");t||(t={});let n=t.header===!0?0:1,e=o.split(".")[n];if(typeof e!="string")throw new i(`Invalid token specified: missing part #${n+1}`);let r;try{r=f(e)}catch(a){throw new i(`Invalid token specified: invalid base64 for part #${n+1} (${a.message})`)}try{return JSON.parse(r)}catch(a){throw new i(`Invalid token specified: invalid json for part #${n+1} (${a.message})`)}}var S=(()=>{let t=class t{constructor(e,r){this.http=e,this.router=r,this.apiUrl="https://sazanowine-api-dev.azurewebsites.net/api/identity",this.loggedInStatus=new c(this.checkToken())}registerUser(e){return this.http.post(`${this.apiUrl}/register`,e)}loginUser(e){return this.http.post(`${this.apiUrl}/login`,e).pipe(d(r=>{r&&r.token&&(localStorage.setItem("token",r.token),this.loggedInStatus.next(!0))}))}logout(){localStorage.removeItem("token"),this.loggedInStatus.next(!1),this.router.navigate(["/"])}isLoggedIn(){return this.loggedInStatus.asObservable()}checkToken(){return!!localStorage.getItem("token")}decodeToken(){let e=localStorage.getItem("token");if(e)try{return h(e)}catch(r){return console.error("Error decoding token",r),null}return null}isTokenExpired(){let e=this.decodeToken();if(e&&e.exp){let r=new Date(0);return r.setUTCSeconds(e.exp),r<new Date}return!0}};t.\u0275fac=function(r){return new(r||t)(s(p),s(u))},t.\u0275prov=l({token:t,factory:t.\u0275fac,providedIn:"root"});let o=t;return o})();export{S as a};
