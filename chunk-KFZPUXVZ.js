import{a as te}from"./chunk-L5XP5ZMC.js";import{a as ee}from"./chunk-E2NKTEJE.js";import{a as V,b as u,c as G,d as H,f as A,h as Q,i as R,j as U,k as Y,l as J,m as K,n as W,p as X}from"./chunk-MNUIFTDK.js";import{a as Z}from"./chunk-CPAFCOQH.js";import{e as q}from"./chunk-R35YXR6G.js";import{t as T}from"./chunk-DINTEC56.js";import{b as L,c as z,d as j,e as $}from"./chunk-VI3CUPN7.js";import{Cb as l,Db as m,Eb as s,Fb as O,Kb as D,Mb as p,Nb as c,Oa as i,Pa as _,Z as E,_a as h,a as P,ab as v,ca as w,cb as B,eb as f,fa as N,fb as k,gb as I,hb as M,ib as a,jb as n,kb as C,sb as b,tb as S,wb as F}from"./chunk-EN55G2KO.js";var ie=(()=>{let o=class o{constructor(r){this.http=r,this.jsonUrl="assets/cities/cities.json"}getCities(){return this.http.get(this.jsonUrl)}};o.\u0275fac=function(d){return new(d||o)(w(T))},o.\u0275prov=E({token:o,factory:o.\u0275fac,providedIn:"root"});let t=o;return t})();function oe(t,o){if(t&1&&(a(0,"div")(1,"h6",3),l(2),n(),a(3,"p",3),l(4),n()()),t&2){let g=o.$implicit;i(2),O("",g.wine.name," ",g.quantity,"x"),i(2),s("",g.wine.price*g.quantity," \u20BE")}}function le(t,o){t&1&&(a(0,"small"),l(1),p(2,"translate"),n()),t&2&&(i(),m(c(2,1,"auth.required-field")))}function pe(t,o){t&1&&(a(0,"small"),l(1),p(2,"translate"),n()),t&2&&(i(),m(c(2,1,"auth.invalid-field")))}function ce(t,o){t&1&&(a(0,"small"),l(1),p(2,"translate"),n()),t&2&&(i(),m(c(2,1,"auth.required-field")))}function de(t,o){t&1&&(a(0,"small"),l(1),p(2,"translate"),n()),t&2&&(i(),m(c(2,1,"auth.invalid-field")))}function me(t,o){t&1&&(a(0,"small"),l(1),p(2,"translate"),n()),t&2&&(i(),m(c(2,1,"auth.required-field")))}function se(t,o){t&1&&(a(0,"small"),l(1),p(2,"translate"),n()),t&2&&(i(),m(c(2,1,"auth.invalid-field")))}function ue(t,o){t&1&&(a(0,"small"),l(1),p(2,"translate"),n()),t&2&&(i(),m(c(2,1,"auth.required-field")))}function ge(t,o){if(t&1&&l(0),t&2){let g=S().$implicit;s(" ",g.name_ka," ")}}function he(t,o){if(t&1&&l(0),t&2){let g=S().$implicit;s(" ",g.name_en," ")}}function ve(t,o){if(t&1&&(a(0,"option",19),h(1,ge,1,1)(2,he,1,1),n()),t&2){let g=o.$implicit,r=S();F("value",g.name_ka),i(),f(r.isGeorgian?1:2)}}function fe(t,o){t&1&&(a(0,"small"),l(1),p(2,"translate"),n()),t&2&&(i(),m(c(2,1,"auth.required-field")))}function Ce(t,o){t&1&&(a(0,"small"),l(1),p(2,"translate"),n()),t&2&&(i(),m(c(2,1,"auth.invalid-field")))}function _e(t,o){t&1&&C(0,"app-loading")}var Ne=(()=>{let o=class o{constructor(r,d,e,x,y,ne){this.cartService=r,this.fb=d,this.orderService=e,this.citiesService=x,this.languageService=y,this.router=ne,this.cartItems=[],this.cities=[],this.isGeorgian=!1,this.isLoading=!1}ngOnInit(){this.getCartItems(),this.initCheckoutForm(),this.getCities(),this.checkLanguage()}ngOnDestroy(){this.cartSubscription&&this.cartSubscription.unsubscribe()}onSubmit(){let r=P({},this.checkoutForm.value);delete r.cardHolderName,delete r.cardNumber,delete r.cvv,delete r.expiryDate,this.isLoading=!0,this.orderService.addOrder(r).subscribe(d=>{this.isLoading=!1,this.cartService.clearCart(),this.router.navigate(["/checkout-success"])},d=>console.error(d))}formatCardNumber(r){let d=r.target,e=d.value.replace(/\s+/g,"");e.length>0&&(e=e.match(/.{1,4}/g)?.join(" ")??e),d.value=e,this.checkoutForm.get("cardNumber")?.setValue(e)}formatExpiryDate(r){let e=r.target.value.replace(/\D/g,"");e.length>=2&&(e=e.substring(0,2)+"/"+e.substring(2,4)),this.checkoutForm.get("expiryDate")?.setValue(e)}getTotalAmount(){return this.cartItems.reduce((r,d)=>r+d.wine.price*d.quantity,0)}getTotalQuantity(){return this.cartItems.reduce((r,d)=>r+d.quantity,0)}get cardNumber(){return this.checkoutForm.get("cardNumber")}get expiryDate(){return this.checkoutForm.get("expiryDate")}get cvv(){return this.checkoutForm.get("cvv")}get cardHolderName(){return this.checkoutForm.get("cardHolderName")}get address(){return this.checkoutForm.get("address")}get city(){return this.checkoutForm.get("city")}get zip(){return this.checkoutForm.get("zip")}get name(){return this.checkoutForm.get("cardHolderName")}getCartItems(){this.cartSubscription=this.cartService.cartItems$.subscribe(r=>{this.cartItems=r})}initCheckoutForm(){this.checkoutForm=this.fb.group({cardNumber:["",[u.required,u.pattern(/^\d{4} \d{4} \d{4} \d{4}$/)]],expiryDate:["",[u.required,u.pattern(/^\d{2}\/\d{2}$/)]],cvv:["",[u.required,u.pattern(/^\d{3}$/)]],cardHolderName:["",[u.required]],address:["",[u.required]],city:["",u.required],zip:["",[u.required,u.pattern(/^\d{5}$/)]],comment:[""],items:this.fb.array(this.cartItems.map(r=>this.fb.group({wineId:r.wine.id,quantity:r.quantity})))})}getCities(){this.citiesService.getCities().subscribe(r=>{this.cities=r.cities,console.log(this.cities)},r=>console.error(r))}checkLanguage(){this.languageService.language$.subscribe(r=>{this.isGeorgian=r==="geo"})}};o.\u0275fac=function(d){return new(d||o)(_(te),_(W),_(ee),_(ie),_(j),_(q))},o.\u0275cmp=N({type:o,selectors:[["app-checkout"]],standalone:!0,features:[D],decls:84,vars:62,consts:[[1,"wrapper"],[1,"receipt"],[3,"appLangClass"],[1,"eng-primary"],[3,"ngSubmit","formGroup","appLangClass"],[1,"form-group"],["for","card-number"],["type","text","id","card-number","name","card-number","formControlName","cardNumber","placeholder","1234 1234 1234 1234","maxlength","19",1,"form-control",3,"input"],[1,"split"],["for","expiry-date"],["type","text","id","expiry-date","name","expiry-date","placeholder","MM/YY","formControlName","expiryDate",1,"form-control",3,"input"],["for","cvc"],["type","text","id","cvc","name","cvc","placeholder","CVC","formControlName","cvv",1,"form-control"],["for","name"],["type","text","id","name","name","name","formControlName","cardHolderName",1,"form-control"],["for","address"],["type","text","id","address","name","address","formControlName","address",1,"form-control",3,"placeholder"],["for","city"],["id","city","name","city","formControlName","city",1,"form-control"],[3,"value"],["for","zip"],["type","text","id","zip","name","zip","formControlName","zip",1,"form-control"],["for","comment"],["id","comment","name","comment","formControlName","comment",1,"form-control"],["type","submit",1,"primary-btn",3,"appLangClass"]],template:function(d,e){d&1&&(a(0,"div",0)(1,"div",1)(2,"div")(3,"h5",2),l(4),p(5,"translate"),n(),a(6,"p",2),l(7),p(8,"translate"),n()(),I(9,oe,5,3,"div",null,k),C(11,"hr"),a(12,"div")(13,"h6",2),l(14),p(15,"translate"),n(),a(16,"p",3),l(17),n()()(),a(18,"form",4),b("ngSubmit",function(){return e.onSubmit()}),a(19,"h5",2),l(20),p(21,"translate"),n(),a(22,"p"),l(23),p(24,"translate"),n(),a(25,"div",5)(26,"label",6),l(27),p(28,"translate"),n(),a(29,"input",7),b("input",function(y){return e.formatCardNumber(y)}),n(),h(30,le,3,3,"small")(31,pe,3,3,"small"),n(),a(32,"div",8)(33,"div",5)(34,"label",9),l(35),p(36,"translate"),n(),a(37,"input",10),b("input",function(y){return e.formatExpiryDate(y)}),n(),h(38,ce,3,3,"small")(39,de,3,3,"small"),n(),a(40,"div",5)(41,"label",11),l(42),p(43,"translate"),n(),C(44,"input",12),h(45,me,3,3,"small")(46,se,3,3,"small"),n()(),a(47,"div",5)(48,"label",13),l(49),p(50,"translate"),n(),C(51,"input",14),h(52,ue,3,3,"small"),n(),a(53,"div",5)(54,"label",15),l(55),p(56,"translate"),n(),C(57,"input",16),p(58,"translate"),n(),a(59,"div",8)(60,"div",5)(61,"label",17),l(62),p(63,"translate"),n(),a(64,"select",18),I(65,ve,3,2,"option",19,k),n()(),a(67,"div",5)(68,"label",20),l(69),p(70,"translate"),n(),C(71,"input",21),h(72,fe,3,3,"small")(73,Ce,3,3,"small"),n()(),a(74,"div",5)(75,"label",22),l(76),p(77,"translate"),n(),C(78,"textarea",23),n(),a(79,"button",24)(80,"span"),l(81),p(82,"translate"),n()()()(),h(83,_e,1,0,"app-loading")),d&2&&(i(3),v("appLangClass","geo-primary, eng-primary, ru-primary"),i(),m(c(5,32,"cart.title")),i(2),v("appLangClass","geo-secondary, eng-secondary, ru-secondary"),i(),O("",e.getTotalQuantity()," ",c(8,34,"cart.items"),""),i(2),M(e.cartItems),i(4),v("appLangClass","geo-secondary, eng-secondary, ru-secondary"),i(),m(c(15,36,"cart.total")),i(3),s("",e.getTotalAmount()," \u20BE"),i(),v("formGroup",e.checkoutForm)("appLangClass","geo-secondary, eng-secondary, ru-secondary"),i(),v("appLangClass","geo-primary, eng-primary, ru-primary"),i(),s(" ",c(21,38,"checkout.title")," "),i(3),s(" ",c(24,40,"checkout.description")," "),i(4),m(c(28,42,"checkout.card-number")),i(3),f(e.cardNumber!=null&&e.cardNumber.touched&&(!(e.cardNumber==null||e.cardNumber.errors==null)&&e.cardNumber.errors.required)?30:e.cardNumber!=null&&e.cardNumber.dirty&&(!(e.cardNumber==null||e.cardNumber.errors==null)&&e.cardNumber.errors.pattern)?31:-1),i(5),m(c(36,44,"checkout.expiry-date")),i(3),f(e.expiryDate!=null&&e.expiryDate.touched&&(!(e.expiryDate==null||e.expiryDate.errors==null)&&e.expiryDate.errors.required)?38:e.expiryDate!=null&&e.expiryDate.dirty&&(!(e.expiryDate==null||e.expiryDate.errors==null)&&e.expiryDate.errors.pattern)?39:-1),i(4),m(c(43,46,"checkout.cvc")),i(3),f(e.cvv!=null&&e.cvv.touched&&(!(e.cvv==null||e.cvv.errors==null)&&e.cvv.errors.required)?45:e.cvv!=null&&e.cvv.dirty&&(!(e.cvv==null||e.cvv.errors==null)&&e.cvv.errors.pattern)?46:-1),i(4),s(" ",c(50,48,"checkout.name")," "),i(3),f(e.name!=null&&e.name.touched&&(!(e.name==null||e.name.errors==null)&&e.name.errors.required)?52:-1),i(3),s(" ",c(56,50,"checkout.address")," "),i(2),v("placeholder",c(58,52,"checkout.address-placeholder")),i(5),s(" ",c(63,54,"checkout.city")," "),i(3),M(e.cities),i(4),s(" ",c(70,56,"checkout.zip")," "),i(3),f(e.zip!=null&&e.zip.touched&&(!(e.zip==null||e.zip.errors==null)&&e.zip.errors.required)?72:e.zip!=null&&e.zip.dirty&&(!(e.zip==null||e.zip.errors==null)&&e.zip.errors.pattern)?73:-1),i(4),s(" ",c(77,58,"checkout.comment")," "),i(3),B("is-disabled",e.checkoutForm.invalid),v("appLangClass","geo-primary, eng-primary, ru-primary"),i(2),s(" ",c(82,60,"checkout.submit")," "),i(2),f(e.isLoading?83:-1))},dependencies:[z,L,$,X,A,Y,J,V,U,G,H,K,Q,R,Z],styles:[".wrapper[_ngcontent-%COMP%]{min-height:calc(100vh - 358px);padding:70px 20px 0;display:flex;flex-direction:column;gap:20px;align-items:center}.wrapper[_ngcontent-%COMP%] > .receipt[_ngcontent-%COMP%]{padding:20px;width:100%;max-width:345px;aspect-ratio:1/1;border-radius:35px;border:2px solid #4c0027;display:flex;flex-direction:column;justify-content:space-around}.wrapper[_ngcontent-%COMP%] > .receipt[_ngcontent-%COMP%] > hr[_ngcontent-%COMP%]{border:2px solid #4c0027;border-radius:5px}.wrapper[_ngcontent-%COMP%] > .receipt[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.wrapper[_ngcontent-%COMP%] > .receipt[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .wrapper[_ngcontent-%COMP%] > .receipt[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{margin:0}.wrapper[_ngcontent-%COMP%] > .receipt[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%;padding:10px 20px;background-color:#4c0027;border:none;border-radius:5px;color:#fff;font-weight:700;cursor:pointer;transition:.3s}.wrapper[_ngcontent-%COMP%] > .receipt[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{opacity:.8}.wrapper[_ngcontent-%COMP%] > form[_ngcontent-%COMP%]{width:100%;max-width:345px}.wrapper[_ngcontent-%COMP%] > form[_ngcontent-%COMP%] > .form-group[_ngcontent-%COMP%]{width:100%}.wrapper[_ngcontent-%COMP%] > form[_ngcontent-%COMP%]   .split[_ngcontent-%COMP%]{display:flex;gap:20px}@media screen and (min-width: 768px){.wrapper[_ngcontent-%COMP%]{padding:40px 60px 0;min-height:calc(100vh - 436px)}}@media screen and (min-width: 1024px){.wrapper[_ngcontent-%COMP%]{padding:40px 80px 0;flex-direction:row;justify-content:center;gap:60px}}@media screen and (min-width: 1920px){.wrapper[_ngcontent-%COMP%]{min-height:calc(100vh - 474px);padding:40px 12% 0;gap:100px}.wrapper[_ngcontent-%COMP%] > form[_ngcontent-%COMP%]{width:50%;max-width:50%}.wrapper[_ngcontent-%COMP%] > form[_ngcontent-%COMP%] > .split[_ngcontent-%COMP%] > .form-group[_ngcontent-%COMP%]{width:50%}}"]});let t=o;return t})();export{Ne as CheckoutComponent};
